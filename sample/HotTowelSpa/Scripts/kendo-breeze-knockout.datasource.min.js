/*! kendo-breeze-knockout.datasource - v0.0.5 - 2013-05-20 - https://github.com/jstott/kendo-breeze-knockout.git */
(function(e,t,n,i){"use strict";function r(e){this.entityManager=e.entityManager,this.endPoint=e.endPoint,this.defaultSort=e.defaultSort,this.mapping=e.mapping,this.onFail=e.onFail,this.inlineCount=e.serverPaging,this.serverPaging=e.serverPaging,this.serverSorting=e.serverSorting,this.serverFiltering=e.serverFiltering}function a(e,t){return e!==void 0?e:t}function o(e){var t={eq:"eq",neq:"ne",lt:"lt",lte:"le",gt:"gt",gte:"ge",startswith:"startswith",endswith:"endswith",contains:"substringof"};return t[e]}function s(e,t){if(null===e||null===t)return e;if(t===!1)return t;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}t.data.extensions=t.data.extensions||{},e.extend(r.prototype,{read:function(e){function t(t){return l.data=d.mapping.mapToJS(t.results),d.inlineCount&&(l.total=t.inlineCount),e.success(l),!0}function i(e){return l.error=e,d.onFail&&d.onFail(e),!0}var r=this.defaultSort,a=(this.defaultFilter,e.data.sort),s=e.data.filter,u=(e.useLocalCache,{}),l={data:[],total:0},d=this;if(u="string"==typeof this.endPoint?new n.EntityQuery(this.endPoint):this.endPoint,a&&a.length>0){r="";for(var g=0;a.length>g;g++)g>0&&(r+=","),r+=a[g].field+" "+a[g].dir}if(this.serverSorting&&r&&(u=u.orderBy(r)),this.serverFiltering&&s&&s.filters.length>0)for(var c=0;s.filters.length>c;c++)u=u.where(s.filters[c].field,o(s.filters[c].operator),s.filters[c].value);this.serverPaging&&(e.data.skip&&(u=u.skip(e.data.skip)),e.data.take&&(u=u.take(e.data.take))),u=u.inlineCount(this.inlineCount),this.entityManager.executeQuery(u).then(t).fail(i).done()},create:function(e){e.success(e.data)},update:function(e){e.success(e.data)},destroy:function(e){e.success(e.data)}}),t.data.extensions.BreezeDataSource=t.data.DataSource.extend({init:function(n){if(!n.entityManager)throw Error('A Breeze EntityManager object is required in order to use the DataSource with Breeze. Please specify an "entityManager" property in your options object.');if(!n.endPoint)throw Error('An "endpoint" option is required in order to work with Breeze. Please specify an "endpoint" property in your options object.');n.pageSize=a(n.pageSize,10),n.serverPaging=a(n.serverPaging,!0),n.defaultSort=n.defaultSort||"",n.serverSorting=a(n.serverSorting,!0),n.serverFiltering=a(n.serverFiltering,!0),n.useLocalCache=a(n.useLocalCache,!0),n.mapping=s({baseIgnore:["entityType","entityAspect"],include:[],ignore:[],mapToJS:function(e){var t={include:this.include,ignore:this.baseIgnore.concat(this.ignore)};if(!i.mapping)throw Error("knockout mapping plugin is required!");return i.mapping.toJS(e,t)}},n.mapping),n.schema=s({data:"data",total:"total",error:"error"},n.schema);var o=new r(n);n=e.extend({},{transport:o},n),t.data.DataSource.fn.init.call(this,n)}})})($,kendo,breeze,ko);